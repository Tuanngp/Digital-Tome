<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!--===============================================================================================-->
</head>
<!-- Compiled and minified CSS -->
<div class="container">

    <form id="commentForm" method="POST">
        <div class="form-group">
            <input class="form-control" id="name" name="username" placeholder="Enter Name" type="text" th:value="${#authentication.principal.username}" readonly />
        </div>
        <div class="form-group">
            <input class="form-control" id="content" name="content" placeholder="Enter Comment" required
                   rows="5"/>
        </div>
        <span id="message"></span>
        <div class="form-group">
            <input id="parentCommentId" name="parentCommentId" type="hidden" />
            <input class="btn btn-primary" id="submit" name="submit" type="submit" value="Post Comment"/>
        </div>
    </form>
    <div id="showComments"></div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script>
    function showComments() {
        $.ajax({
            //Get comment html code
            url: "http://localhost:8080/api/test",
            method: "GET",
            success: function (response) {
                $('#showComments').html(response);
            }
        })
    }

    $(document).ready(function () {
        showComments();
        $('#commentForm').on('submit', function (event) {
            event.preventDefault();
            var formData = $(this).serializeArray();
            var formDataObject = {};
            $.each(formData,
                function (i, v) {
                    formDataObject[v.name] = v.value;
                });
            console.log(formDataObject);
            $.ajax({
                //Post comment
                url: "http://localhost:8080/api/comments",
                method: "POST",
                data: formDataObject,
                dataType: 'json',
                xhrFields: {
                    withCredentials: false
                },

                success: function (response) {
                    showComments();
                }
            })
        });
        $(document).on('click', '.reply', function () {
            //Reply to this id
            const commentId = $(this).attr("id");
            $('#parentCommentId').val(commentId);
            $('#name').focus();
            console.log(commentId);
            console.log($('#parentCommentId').val());
        });
    });
</script>
</html>